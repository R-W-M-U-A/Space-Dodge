<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Space Dodge — мінігра</title>
  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    #gameWrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;background:linear-gradient(180deg,#020024 0%,#090927 60%);color:#fff}
    canvas{background:transparent;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    .ui{width:100%;max-width:480px;margin-top:14px;display:flex;justify-content:space-between;align-items:center}
    .btn{background:#1b9bf0;border:none;padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.12)}
    #overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
    .panel{background:rgba(0,0,0,0.6);backdrop-filter:blur(6px);padding:18px;border-radius:12px;text-align:center}
    .big{font-size:20px;font-weight:700}
    .muted{opacity:0.8;font-size:13px}
    .score{font-weight:800}
    .small{font-size:13px}
    footer{position:fixed;left:12px;bottom:12px;font-size:12px;color:rgba(255,255,255,0.6)}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="480" height="680"></canvas>
    <div class="ui">
      <div>Score: <span id="score">0</span></div>
      <div>
        <button id="startBtn" class="btn">Грати</button>
        <button id="muteBtn" class="btn secondary">Музика: Вкл</button>
      </div>
    </div>
    <div style="margin-top:8px;max-width:480px;text-align:center" class="muted small">Керування: мишкою або стрілками/тач</div>
  </div>

  <div id="overlay" style="display:none">
    <div class="panel">
      <div id="overlayText" class="big">Space Dodge</div>
      <div class="muted" style="margin-top:8px">Уникай астероїдів, збирай монети. Чим довше граєш — тим більше заробляєш!</div>
      <div style="margin-top:12px">
        <button id="playNow" class="btn">Почати гру</button>
        <button id="shareBtn" class="btn secondary">Поділитися результатом</button>
      </div>
    </div>
  </div>

  <footer>Made with ♥ — Space Dodge</footer>

  <script>
  // --- Simple 2D Canvas Mini Game: Space Dodge ---
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  let state = 'menu'; // menu, playing, gameover
  let scoreEl = document.getElementById('score');
  let overlay = document.getElementById('overlay');
  let overlayText = document.getElementById('overlayText');

  // Player
  const player = { x: W/2, y: H - 80, r: 18, speed: 6 };

  // Arrays
  let asteroids = [];
  let coins = [];

  // Timing
  let lastTime = 0;
  let spawnTimer = 0;
  let coinTimer = 0;
  let score = 0;

  // Controls
  const keys = {};
  let pointerX = null;

  // Audio (simple beep using oscillator)
  let audioEnabled = true;

  function playBeep(f=440,d=0.06){
    if(!audioEnabled) return;
    try{
      const a = new (window.AudioContext || window.webkitAudioContext)();
      const o = a.createOscillator();
      const g = a.createGain();
      o.type = 'sine';
      o.frequency.value = f;
      g.gain.value = 0.02;
      o.connect(g); g.connect(a.destination);
      o.start();
      setTimeout(()=>{o.stop();a.close();}, d*1000);
    }catch(e){}
  }

  // Helpers
  function rand(min,max){return Math.random()*(max-min)+min}
  function dist(a,b,c,d){const dx=a-c,dy=b-d;return Math.sqrt(dx*dx+dy*dy)}

  function spawnAsteroid(){
    const size = rand(14,40);
    asteroids.push({x:rand(size,W-size),y:-size,r:size,spd:rand(1.2,3.4),rot:rand(-0.02,0.02),ang:0});
  }
  function spawnCoin(){
    const size = 10;
    coins.push({x:rand(20,W-20),y:-20,r:size,spd:rand(1.4,2.6)});
  }

  function reset(){
    asteroids=[];coins=[];score=0;spawnTimer=0;coinTimer=0;state='playing';overlay.style.display='none';
  }

  function gameOver(){
    state='gameover';
    overlayText.innerHTML = `Гра закінчена<br>Рахунок: ${score}`;
    overlay.style.display='flex';
    playBeep(120,0.14);
    // Here you could call a monetization hook: show interstitial ad or offer premium
    // showInterstitialAd();
  }

  function update(dt){
    if(state!=='playing') return;
    // spawn asteroids
    spawnTimer += dt;
    if(spawnTimer>0.8){spawnAsteroid(); spawnTimer=0;}
    // spawn coins less often
    coinTimer += dt;
    if(coinTimer>2.4){spawnCoin(); coinTimer=0;}

    // update asteroids
    for(let i=asteroids.length-1;i>=0;i--){
      const a = asteroids[i];
      a.y += a.spd * (60*dt);
      a.ang += a.rot;
      if(a.y - a.r > H) asteroids.splice(i,1);
      // collision
      if(dist(a.x,a.y,player.x,player.y) < a.r + player.r - 6){
        gameOver();
        return;
      }
    }

    // update coins
    for(let i=coins.length-1;i>=0;i--){
      const c = coins[i];
      c.y += c.spd * (60*dt);
      if(c.y - c.r > H) coins.splice(i,1);
      else if(dist(c.x,c.y,player.x,player.y) < c.r + player.r - 2){
        coins.splice(i,1); score += 5; scoreEl.innerText = score; playBeep(880,0.05);
      }
    }

    // player movement: keyboard
    if(keys['ArrowLeft'] || keys['a']) player.x -= player.speed * (60*dt);
    if(keys['ArrowRight']|| keys['d']) player.x += player.speed * (60*dt);
    if(keys['ArrowUp']   || keys['w']) player.y -= player.speed * (60*dt);
    if(keys['ArrowDown'] || keys['s']) player.y += player.speed * (60*dt);
    // pointer/touch movement smoothing
    if(pointerX !== null){ player.x += (pointerX - player.x) * 0.14; }

    // bounds
    player.x = Math.max(player.r, Math.min(W-player.r, player.x));
    player.y = Math.max(player.r, Math.min(H-player.r, player.y));

    // score grows with time
    score += Math.floor(0.02 * (60*dt));
    scoreEl.innerText = score;
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    // stars
    for(let i=0;i<60;i++){
      ctx.fillStyle = 'rgba(255,255,255,' + (Math.random()*0.5)+')';
      const sx = (i*73)%W; const sy = (i*101)%H;
      ctx.fillRect(sx,sy,1,1);
    }

    // coins
    for(const c of coins){
      ctx.save(); ctx.translate(c.x,c.y);
      ctx.beginPath(); ctx.arc(0,0,c.r,0,Math.PI*2); ctx.fillStyle='gold'; ctx.fill(); ctx.lineWidth=2; ctx.strokeStyle='rgba(255,255,255,0.6)'; ctx.stroke();
      ctx.restore();
    }

    // asteroids
    for(const a of asteroids){
      ctx.save(); ctx.translate(a.x,a.y); ctx.rotate(a.ang);
      ctx.beginPath(); ctx.moveTo(-a.r*0.6, -a.r*0.6);
      for(let p=0;p<7;p++){
        const ang = p/7*Math.PI*2;
        const rr = a.r * (0.6 + Math.sin(p*3.2 + a.ang)*0.18);
        ctx.lineTo(Math.cos(ang)*rr, Math.sin(ang)*rr);
      }
      ctx.closePath(); ctx.fillStyle='rgba(120,110,100,0.95)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.lineWidth=1; ctx.stroke();
      ctx.restore();
    }

    // player ship
    ctx.save(); ctx.translate(player.x, player.y);
    ctx.beginPath(); ctx.moveTo(0,-player.r-4); ctx.lineTo(-player.r, player.r+4); ctx.lineTo(player.r, player.r+4); ctx.closePath();
    ctx.fillStyle='#1b9bf0'; ctx.fill(); ctx.lineWidth=2; ctx.strokeStyle='rgba(255,255,255,0.2)'; ctx.stroke();
    ctx.restore();
  }

  function loop(ts){
    if(!lastTime) lastTime = ts;
    const dt = Math.min(0.05, (ts - lastTime)/1000);
    lastTime = ts;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  // input handlers
  window.addEventListener('keydown', e=>{keys[e.key]=true; if(state!=='playing' && e.key==='Enter'){ reset(); }});
  window.addEventListener('keyup', e=>{keys[e.key]=false;});
  canvas.addEventListener('mousemove', e=>{const r=canvas.getBoundingClientRect();pointerX = (e.clientX - r.left) / (r.width) * W;});
  canvas.addEventListener('touchmove', e=>{e.preventDefault();const t=e.touches[0];const r=canvas.getBoundingClientRect();pointerX=(t.clientX - r.left)/r.width*W;}, {passive:false});
  canvas.addEventListener('touchstart', e=>{e.preventDefault(); if(state!=='playing') reset();}, {passive:false});

  // UI buttons
  document.getElementById('startBtn').addEventListener('click', ()=>{ reset(); });
  document.getElementById('playNow').addEventListener('click', ()=>{ reset(); });
  document.getElementById('shareBtn').addEventListener('click', ()=>{ const text = `Мій рахунок у Space Dodge: ${score}! Спробуй перевершити!`; if(navigator.share){navigator.share({title:'Space Dodge',text,url:location.href}).catch(()=>{});} else {prompt('Скопіюй і поділись:', text + ' ' + location.href);} });
  document.getElementById('muteBtn').addEventListener('click', e=>{audioEnabled = !audioEnabled; e.target.innerText = 'Музика: ' + (audioEnabled? 'Вкл':'Викл');});

  // Start loop
  overlay.style.display='flex';
  requestAnimationFrame(loop);

  // --- Monetization hooks & placeholders ---
  // 1) Banner ad placeholder: you can add an element <div id="bannerAd"> and insert ad network script there.
  // 2) Interstitial: call showInterstitialAd() inside gameOver() to display an ad after player dies.
  // 3) In-app purchases: integrate Stripe Checkout / Paddle on server-side. Example placeholder:
  //    function buyPremium(){ window.open('/buy?product=premium','_blank'); }
  // 4) Tracking: integrate Google Analytics / Plausible to measure DAU/Retention.

  // Example stub for showing interstitial (replace with real network SDK calls)
  function showInterstitialAd(){
    // if using AdMob/Cordova, call the SDK. For web, consider Playwire or GameDistribution.
    console.log('Show interstitial ad (placeholder)');
  }

  </script>
</body>
</html>